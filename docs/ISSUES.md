# FinTrackr - Выявленные проблемы и технический долг

## Backend проблемы

### Критические

1. **Монолитный server.js**
   - Файл содержит ~2000 строк кода
   - Смешивает ответственности: роутинг, бизнес-логику, утилиты
   - Сложно тестировать и поддерживать
   - **Решение:** Разбить на модули (routes, controllers, services)

2. **Отсутствие централизованной обработки ошибок**
   - Ошибки обрабатываются по-разному в разных endpoint'ах
   - Разные форматы ошибок для клиента
   - Утечка технических деталей клиенту
   - **Решение:** Создать error handling middleware

3. **JWT_SECRET по умолчанию в dev режиме**
   - При разработке используется хардкод "dev-secret-change"
   - Потенциальная уязвимость при случайном деплое
   - **Решение:** Требовать JWT_SECRET всегда через .env

### Высокий приоритет

4. **Дублирование кода в routes и services**
   - Часть логики в server.js
   - Часть в отдельных routes файлах
   - Часть в services
   - Нет единого подхода
   - **Решение:** Четкое разделение: routes -> controllers -> services

5. **Неконсистентные HTTP статус коды**
   - Разные endpoint'ы возвращают разные коды для похожих ситуаций
   - 200 вместо 201 при создании
   - 500 вместо 400 при валидации
   - **Решение:** Стандартизировать коды ответов

6. **Недостаточная валидация входных данных**
   - Не все поля проверяются
   - Отсутствуют проверки типов и диапазонов
   - Возможны SQL injection (хотя используется SQLite с параметризацией)
   - **Решение:** Добавить middleware валидации для всех endpoint'ов

7. **Неполная реализация CRUD**
   - Не все ресурсы имеют полный набор операций
   - Например, некоторые endpoint'ы только для чтения
   - **Решение:** Дополнить недостающие операции

### Средний приоритет

8. **Два dataService файла**
   - `dataService.js` и `dataService.new.js`
   - Непонятно какой использовать
   - **Решение:** Выбрать один, удалить другой

9. **Отсутствие rate limiting**
   - API не защищен от злоупотреблений
   - **Решение:** Добавить rate limiting middleware

10. **Логирование**
    - Используется console.log
    - Нет структурированного логирования
    - Нет уровней логов
    - **Решение:** Внедрить winston или pino

11. **CORS настройки**
    - Хардкод в коде
    - Нет гибкой конфигурации
    - **Решение:** Вынести в конфигурацию

12. **Миграции БД**
    - Есть schema.sql, но нет системы миграций
    - При изменении схемы нужно вручную обновлять
    - **Решение:** Внедрить систему миграций (например, node-pg-migrate адаптированный для SQLite)

### Низкий приоритет

13. **Currency service кеширование**
    - Курсы валют запрашиваются каждый раз
    - Можно кешировать на несколько часов
    - **Решение:** Добавить кеширование с TTL

14. **Email service**
    - Есть заглушка, но не реализован
    - **Решение:** Интегрировать SendGrid или аналог

15. **ML Analytics Service**
    - Присутствует, но недостаточно данных для обучения
    - **Решение:** Добавить seed данных или упростить модель

## Frontend проблемы

### Критические

16. **Отсутствие единой дизайн-системы**
    - Каждая страница выглядит по-своему
    - Разные отступы, шрифты, цвета
    - Нет CSS переменных для цветовой схемы
    - **Решение:** Создать design tokens (CSS переменные) и единый стиль

17. **Дублирование кода работы с API**
    - Каждая страница делает свои fetch запросы
    - Повторяющаяся логика обработки ошибок
    - Нет централизованного API клиента
    - **Решение:** Создать API client модуль

18. **Плохая адаптивность**
    - Многие страницы плохо работают на мобильных
    - Нет mobile-first подхода
    - Сложные таблицы не адаптируются
    - **Решение:** Переработать верстку с mobile-first подходом

### Высокий приоритет

19. **Отсутствие состояний UI**
    - Нет индикаторов загрузки
    - Нет обработки пустых состояний ("нет данных")
    - Нет красивых ошибок
    - **Решение:** Добавить loading/empty/error states

20. **Несемантичная разметка**
    - Много `<div>` вместо семантических тегов
    - Плохая доступность (a11y)
    - **Решение:** Использовать `<header>`, `<nav>`, `<main>`, `<article>`, `<section>`, `<footer>`

21. **JavaScript модули**
    - Смешанный подход: где-то модули, где-то нет
    - Нет четкой структуры импортов
    - **Решение:** Полностью перейти на ES модули

22. **Отсутствие компонентного подхода**
    - Код для таблиц, форм, карточек повторяется
    - **Решение:** Создать переиспользуемые компоненты/функции

23. **Графики на Canvas**
    - Код рисования сложный и не переиспользуемый
    - **Решение:** Рассмотреть Chart.js или создать простую обертку

### Средний приоритет

24. **Навигация**
    - Меню не адаптируется под мобильные
    - Нет индикации активной страницы
    - **Решение:** Сделать responsive навигацию с бургер-меню

25. **Формы**
    - Нет клиентской валидации
    - Нет показа ошибок рядом с полями
    - **Решение:** Добавить client-side валидацию

26. **Темная тема**
    - Заявлена в README, но не везде работает корректно
    - **Решение:** Проверить и исправить все страницы

27. **Accessibility (a11y)**
    - Отсутствуют aria-labels
    - Плохая навигация с клавиатуры
    - Контрастность цветов не проверена
    - **Решение:** Audit с инструментами a11y, исправления

### Низкий приоритет

28. **Анимации**
    - Нет плавных переходов
    - UI кажется резким
    - **Решение:** Добавить CSS transitions

29. **Иконки**
    - Разные стили иконок
    - **Решение:** Использовать единый icon set (например, Feather Icons)

30. **Типографика**
    - Неконсистентные размеры шрифтов
    - **Решение:** Создать типографическую шкалу

## База данных проблемы

### Критические

31. **Отсутствие seed данных**
    - Нет данных для демонстрации
    - Сложно тестировать UI
    - **Решение:** Создать скрипт с демо-данными

### Высокий приоритет

32. **Система миграций**
    - Есть schema.sql, но нет версионирования
    - **Решение:** Внедрить миграции

33. **Индексы**
    - Не все часто используемые запросы покрыты индексами
    - **Решение:** Проанализировать запросы и добавить нужные индексы

### Средний приоритет

34. **Нормализация**
    - Некоторые таблицы можно нормализовать лучше
    - Например, валюты могут быть отдельной таблицей
    - **Решение:** Рассмотреть улучшение схемы

35. **Связи**
    - Все связи есть, но можно добавить больше constraints
    - **Решение:** Добавить CHECK constraints где нужно

## Инфраструктура проблемы

### Критические

36. **Отсутствие сборки**
    - Файлы отдаются как есть
    - Нет минификации
    - Нет объединения файлов
    - **Решение:** Настроить Vite или Webpack

37. **PWA**
    - Нет manifest.json
    - Нет service worker
    - Не работает офлайн
    - **Решение:** Внедрить PWA

### Высокий приоритет

38. **Environment variables**
    - Не все настройки через .env
    - **Решение:** Вынести все конфиги в .env

39. **npm scripts**
    - Есть базовые, но не хватает:
      - `build` для продакшен сборки
      - `dev:watch` для auto-reload
    - **Решение:** Дополнить скрипты

40. **Deployment документация**
    - Нет четкой инструкции
    - Не описаны требования к хостингу
    - **Решение:** Написать deployment guide

### Средний приоритет

41. **CI/CD**
    - Нет автоматических проверок
    - **Решение:** Настроить GitHub Actions

42. **Docker**
    - Нет Dockerfile
    - **Решение:** Создать Dockerfile и docker-compose.yml

43. **Lighthouse метрики**
    - Не измерялись
    - **Решение:** Замерить и улучшить

## Тестирование проблемы

### Критические

44. **Падающие тесты** ✅ **РЕШЕНО**
    - ~~14 тестов падают из 52~~ → Все 52 теста проходят
    - `sessionService.test.js` - ✅ исправлены (добавлены методы в dataService, обновлена схема БД)
    - `mlAnalyticsService.test.js` - ✅ исправлены (исправлены имена методов и ожидания тестов)
    - **Решение:** Исправлены тесты и добавлена недостающая функциональность в dataService

### Высокий приоритет

45. **Покрытие кода**
    - Не измеряется
    - Вероятно низкое
    - **Решение:** Настроить coverage reports, увеличить покрытие

46. **E2E тесты**
    - Есть Playwright, но мало тестов
    - **Решение:** Добавить тесты для ключевых сценариев

### Средний приоритет

47. **Integration тесты**
    - Мало тестов интеграции между модулями
    - **Решение:** Добавить integration тесты

## Документация проблемы

### Критические

48. **API документация**
    - Нет описания endpoint'ов
    - Нет примеров запросов/ответов
    - **Решение:** Создать API.md или использовать Swagger

### Высокий приоритет

49. **README неполный**
    - Есть базовая информация
    - Не хватает подробностей по архитектуре, деплою
    - **Решение:** Расширить README

50. **Комментарии в коде**
    - Мало JSDoc комментариев
    - Непонятна логика в некоторых местах
    - **Решение:** Добавить комментарии для сложных мест

### Средний приоритет

51. **Схема БД**
    - Есть SQL, но нет визуальной диаграммы
    - **Решение:** Создать ER-диаграмму

52. **Демо сценарии**
    - Нет описания для демонстрации проекта
    - **Решение:** Написать demo script

## Приоритизация

### Must Have (Перед демо)
- Проблемы 1, 2, 16, 17, 18, 31, 36, 38, 44, 48

### Should Have (Для production)
- Проблемы 3, 4, 5, 6, 7, 19, 20, 21, 32, 37, 39, 40, 45, 49

### Nice to Have (Для улучшения)
- Все остальные проблемы

## Оценка работ

- Критические проблемы: 10
- Высокий приоритет: 18
- Средний приоритет: 16
- Низкий приоритет: 8

**Общее количество выявленных проблем: 52**
