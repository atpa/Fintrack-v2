<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinTrackr – Операции</title>
    <link rel="stylesheet" href="css/design-system.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive-tables.css" />
    <script defer src="js/utils/auth.js"></script>
    <script defer src="js/app.js"></script>
    <script defer src="js/utils/ui.js"></script>
    <script type="module" src="js/transactions.js"></script>
  </head>
  <body class="workspace-page" data-page-title="Операции" data-page-subtitle="Все доходы и расходы в одном месте">
    <header>
      <div class="brand visually-hidden">
        <a href="dashboard.html">FinTrackr</a>
      </div>
      <button class="burger" aria-label="Меню">
        <span></span><span></span><span></span>
      </button>
    </header>

    <aside
      class="sidebar"
      id="sidebar"
      role="navigation"
      aria-label="Боковая навигация"
    >
    <!-- sidebar-top removed: sidebar starts at header edge -->

    <div class="sidebar-scroll">
      <nav class="sidebar-nav" aria-label="Меню приложения">
        <div class="nav-section">
          <h3 class="nav-section-title">Основное</h3>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="dashboard.html" class="nav-link"
                ><span class="nav-icon">🏠</span
                ><span class="nav-label">Дэшборд</span></a
              >
            </li>
            <li class="nav-item">
              <a href="accounts.html" class="nav-link"
                ><span class="nav-icon">💼</span
                ><span class="nav-label">Счёта</span></a
              >
            </li>
            <li class="nav-item">
              <a href="transactions.html" class="nav-link"
                ><span class="nav-icon">🔁</span
                ><span class="nav-label">Операции</span></a
              >
            </li>
            <li class="nav-item">
              <a href="categories.html" class="nav-link"
                ><span class="nav-icon">🔖</span
                ><span class="nav-label">Категории</span></a
              >
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <h3 class="nav-section-title">Планирование</h3>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="budgets.html" class="nav-link"
                ><span class="nav-icon">📊</span
                ><span class="nav-label">Бюджеты</span></a
              >
            </li>
            <li class="nav-item">
              <a href="goals.html" class="nav-link"
                ><span class="nav-icon">🎯</span
                ><span class="nav-label">Цели</span></a
              >
            </li>
            <li class="nav-item">
              <a href="planned.html" class="nav-link"
                ><span class="nav-icon">📅</span
                ><span class="nav-label">Планируемые</span></a
              >
            </li>
            <li class="nav-item">
              <a href="recurring.html" class="nav-link"
                ><span class="nav-icon">🔁</span
                ><span class="nav-label">Регулярные</span></a
              >
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <h3 class="nav-section-title">Аналитика</h3>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="reports.html" class="nav-link"
                ><span class="nav-icon">📈</span
                ><span class="nav-label">Отчёты</span></a
              >
            </li>
            <li class="nav-item">
              <a href="forecast.html" class="nav-link"
                ><span class="nav-icon">🔮</span
                ><span class="nav-label">Прогнозы</span></a
              >
            </li>
            <li class="nav-item">
              <a href="rules.html" class="nav-link"
                ><span class="nav-icon">⚙️</span
                ><span class="nav-label">Правила</span></a
              >
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <h3 class="nav-section-title">Дополнительно</h3>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="education.html" class="nav-link"
                ><span class="nav-icon">📚</span
                ><span class="nav-label">Обучение</span></a
              >
            </li>
            <li class="nav-item">
              <a href="premium.html" class="nav-link"
                ><span class="nav-icon">⭐</span
                ><span class="nav-label">Премиум</span></a
              >
            </li>
            <li class="nav-item">
              <a href="settings.html" class="nav-link"
                ><span class="nav-icon">⚙️</span
                ><span class="nav-label">Настройки</span></a
              >
            </li>
          </ul>
        </div>
      </nav>
    </div>

    </aside>

    <div class="sidebar-backdrop" id="sidebarBackdrop" aria-hidden="true"></div>
    <main class="workspace-main workspace-shell" role="main" aria-label="Управление транзакциями">
      <section class="workspace-hero">
        <div class="hero-main">
          <div>
            <p class="hero-eyebrow">Операции</p>
            <h1>Журнал доходов и расходов</h1>
            <p class="hero-description">Фиксируйте каждую операцию, применяйте фильтры и следите за чистым потоком средств.</p>
            <div class="hero-tags">
              <span class="hero-pill" id="transactionsHeroRange">За всё время</span>
              <span class="hero-pill hero-pill--soft" id="transactionsHeroCurrency">USD</span>
            </div>
          </div>
          <div class="hero-balance-card">
            <p class="muted-label">Чистый поток</p>
            <p class="hero-balance-value">
              <span id="transactionsHeroNet">0.00</span>
              <span id="transactionsHeroCurrencySymbol">USD</span>
            </p>
            <p class="hero-note" id="transactionsHeroCount">0 операций</p>
          </div>
        </div>
        <div class="hero-actions">
          <button class="btn-primary btn-pill" onclick="document.getElementById('txAmount').focus()">+ Добавить операцию</button>
          <button class="btn-secondary btn-pill" onclick="location.href='accounts.html'">К счетам</button>
        </div>
      </section>

      <section class="metrics-grid">
        <article class="metric-card">
          <p class="metric-label">Фильтровано операций</p>
          <p class="metric-value"><strong id="transactionsMetricCount">0</strong></p>
          <p class="metric-subtitle">Из всех загруженных</p>
        </article>
        <article class="metric-card">
            <p class="metric-label">Доходы</p>
          <p class="metric-value">
            <strong id="transactionsMetricIncome">0.00</strong>
            <span class="currency-code" id="transactionsMetricIncomeCurrency">USD</span>
          </p>
          <p class="metric-subtitle">Сумма выбранного диапазона</p>
        </article>
        <article class="metric-card">
            <p class="metric-label">Расходы</p>
          <p class="metric-value">
            <strong id="transactionsMetricExpense">0.00</strong>
            <span class="currency-code" id="transactionsMetricExpenseCurrency">USD</span>
          </p>
          <p class="metric-subtitle">Сумма выбранного диапазона</p>
        </article>
        <article class="metric-card">
            <p class="metric-label">Средний чек</p>
          <p class="metric-value">
            <strong id="transactionsMetricAverage">0.00</strong>
            <span class="currency-code" id="transactionsMetricAverageCurrency">USD</span>
          </p>
          <p class="metric-subtitle">По отфильтрованным операциям</p>
        </article>
      </section>

      <section class="workspace-grid transactions-grid">
        <article class="panel" aria-labelledby="addTransactionTitle">
          <div class="panel-header">
            <div>
              <p class="muted-label">Новая операция</p>
              <h2 id="addTransactionTitle">Добавить операцию</h2>
            </div>
          </div>
          <form id="addTransactionForm" class="panel-body">
            <div class="form-grid">
              <div class="form-field">
                <label for="txDate">Дата</label>
                <input type="date" id="txDate" required />
                <span class="form-error" data-error-for="txDate"></span>
              </div>
              <div class="form-field">
                <label for="txAccount">Счёт</label>
                <select id="txAccount" required></select>
                <span class="form-error" data-error-for="txAccount"></span>
              </div>
              <div class="form-field">
                <label for="txCategory">Категория</label>
                <select id="txCategory" required></select>
                <span class="form-error" data-error-for="txCategory"></span>
              </div>
              <div class="form-field">
                <label for="txType">Тип</label>
                <select id="txType" required>
                  <option value="income">Доход</option>
                  <option value="expense">Расход</option>
                </select>
                <span class="form-error" data-error-for="txType"></span>
              </div>
              <div class="form-field">
                <label for="txAmount">Сумма</label>
                <input type="number" id="txAmount" step="0.01" min="0" required />
                <span class="form-error" data-error-for="txAmount"></span>
              </div>
              <div class="form-field">
                <label for="txCurrency">Валюта</label>
                <select id="txCurrency" required>
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
                  <option value="PLN">PLN</option>
                  <option value="RUB">RUB</option>
                </select>
                <span class="form-error" data-error-for="txCurrency"></span>
              </div>
              <div class="form-field form-field--full">
                <label for="txNote">Комментарий</label>
                <textarea id="txNote" rows="2" placeholder="Необязательно"></textarea>
                <span class="form-error" data-error-for="txNote"></span>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary">Сохранить</button>
            </div>
          </form>
        </article>

        <article class="panel" aria-labelledby="transactionsListTitle">
          <div class="panel-header">
            <div>
              <p class="muted-label">История</p>
              <h2 id="transactionsListTitle">Последние операции</h2>
            </div>
            <button class="btn-ghost" onclick="location.href='reports.html'">Перейти к отчётам</button>
          </div>
          <div class="panel-body">
            <div class="filters-row">
              <div class="form-field">
                <label for="filterStart">С даты</label>
                <input type="date" id="filterStart" />
              </div>
              <div class="form-field">
                <label for="filterEnd">По дату</label>
                <input type="date" id="filterEnd" />
              </div>
              <div class="form-field">
                <label for="filterCategory">Категория</label>
                <select id="filterCategory">
                  <option value="">Все</option>
                </select>
              </div>
              <div class="form-field">
                <label for="filterType">Тип</label>
                <select id="filterType">
                  <option value="">Любой</option>
                  <option value="income">Доход</option>
                  <option value="expense">Расход</option>
                </select>
              </div>
              <div class="form-field">
                <label for="filterSearch">Поиск</label>
                <input type="text" id="filterSearch" placeholder="Название, сумма, комментарий" />
              </div>
            </div>
            <div class="list-meta">
              Отфильтровано: <span id="transactionsFilteredCount">0</span>
            </div>
            <div id="transactionsList" class="tx-list" aria-live="polite"></div>
            <table id="transactionsTable" class="visually-hidden" aria-hidden="true">
              <thead>
                <tr>
                  <th>Дата</th>
                  <th>Счёт</th>
                  <th>Категория</th>
                  <th>Тип</th>
                  <th>Сумма</th>
                  <th>Комментарий</th>
                  <th>Действия</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="7">Загрузка...</td></tr>
              </tbody>
            </table>
            <div class="table-controls">
              <div class="table-pagination" id="transactionsPagination"></div>
            </div>
          </div>
        </article>
      </section>
    </main>
    <footer>
      <p>&copy; 2025 FinTrackr. Все права защищены.</p>
    </footer>
  </body>
</html>
